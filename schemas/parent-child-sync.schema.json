{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ze            sessionSyncMode: { "$ref": "#/$defs/SessionType" }glow.app/schemas/parent-child-connection.json",
  "title": "Parent-Child Connection Schema",
  "description": "Schema for secure parent-child meditation app connectivity",
  "type": "object",
  "$defs": {
    "ConnectionCode": {
      "type": "string",
      "pattern": "^[A-Z0-9]{12}$",
      "description": "12-character alphanumeric connection code"
    },
    "SessionId": {
      "type": "string",
      "pattern": "^session_[0-9]+_[a-z0-9]+$",
      "description": "Unique session identifier"
    },
    "UserId": {
      "type": "string",
      "pattern": "^(parent|child)_[0-9]+$",
      "description": "User identifier with role prefix"
    },
    "MoodLevel": {
      "type": "string",
      "enum": [
        "very-sad",
        "sad", 
        "neutral",
        "happy",
        "very-happy",
        "excited",
        "calm",
        "anxious",
        "frustrated"
      ]
    },
    "SessionType": {
      "type": "string",
      "enum": [
        "parallel-practice",
        "guided-together", 
        "independent-monitored",
        "bedtime-routine"
      ]
    },
    "ExpressionName": {
      "type": "string",
      "enum": [
        "neutral",
        "happy",
        "joyful", 
        "focused",
        "sleepy",
        "excited"
      ]
    }
  },
  "properties": {
    "ParentChildConnection": {
      "type": "object",
      "required": ["parentId", "childId", "connectionCode", "isActive", "connectedAt"],
      "properties": {
        "parentId": { "$ref": "#/$defs/UserId" },
        "childId": { "$ref": "#/$defs/UserId" },
        "connectionCode": { "$ref": "#/$defs/ConnectionCode" },
        "isActive": { "type": "boolean" },
        "connectedAt": { 
          "type": "string", 
          "format": "date-time" 
        },
        "lastHeartbeat": { 
          "type": "string", 
          "format": "date-time" 
        },
        "sharedSettings": {
          "type": "object",
          "properties": {
            "allowParentGuidance": { "type": "boolean" },
            "shareProgress": { "type": "boolean" },
            "enableEncouragement": { "type": "boolean" },
            "sessionSyncMode": { "$ref": "#/definitions/SessionType" }
          },
          "required": ["allowParentGuidance", "shareProgress", "enableEncouragement"]
        }
      }
    },
    "SharedMeditationSession": {
      "type": "object",
      "required": ["sessionId", "parentId", "childId", "sessionType", "startTime", "isActive"],
      "properties": {
        "sessionId": { "$ref": "#/definitions/SessionId" },
        "parentId": { "$ref": "#/definitions/UserId" },
        "childId": { "$ref": "#/definitions/UserId" },
        "sessionType": { "$ref": "#/definitions/SessionType" },
        "startTime": { 
          "type": "string", 
          "format": "date-time" 
        },
        "endTime": { 
          "type": "string", 
          "format": "date-time" 
        },
        "plannedDuration": {
          "type": "number",
          "minimum": 1,
          "maximum": 120,
          "description": "Duration in minutes"
        },
        "isActive": { "type": "boolean" },
        "childProgress": {
          "type": "object",
          "required": ["currentStep", "completionPercentage", "breathingSync", "engagementLevel", "lastUpdate"],
          "properties": {
            "currentStep": {
              "type": "integer",
              "minimum": 0
            },
            "completionPercentage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "breathingSync": { "type": "boolean" },
            "engagementLevel": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "lastUpdate": { 
              "type": "string", 
              "format": "date-time" 
            },
            "heartRate": {
              "type": "integer",
              "minimum": 40,
              "maximum": 200,
              "description": "Beats per minute - SENSITIVE DATA"
            },
            "stressLevel": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "0=calm, 1=stressed - SENSITIVE DATA"
            }
          }
        },
        "parentGuidance": {
          "type": "object",
          "properties": {
            "encouragementSent": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 200
              }
            },
            "guidanceNotes": {
              "type": "array", 
              "items": {
                "type": "string",
                "maxLength": 500
              }
            },
            "interventionsUsed": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "breathing-reminder",
                  "posture-adjustment", 
                  "focus-redirect",
                  "calming-sound",
                  "avatar-interaction"
                ]
              }
            }
          }
        }
      }
    },
    "SecureMessage": {
      "type": "object",
      "required": ["messageId", "fromParent", "content", "timestamp", "messageType"],
      "properties": {
        "messageId": {
          "type": "string",
          "pattern": "^msg_[0-9]+_[a-z0-9]+$"
        },
        "fromParent": { "type": "boolean" },
        "content": {
          "type": "string",
          "maxLength": 200,
          "description": "Message content - sanitized for security"
        },
        "timestamp": { 
          "type": "string", 
          "format": "date-time" 
        },
        "messageType": {
          "type": "string",
          "enum": [
            "encouragement",
            "guidance", 
            "check-in",
            "celebration",
            "reminder"
          ]
        },
        "acknowledged": { "type": "boolean" },
        "encrypted": { "type": "boolean" }
      }
    },
    "ChildMoodTracking": {
      "type": "object",
      "required": ["sessionId", "preMeditationMood", "timestamp"],
      "properties": {
        "sessionId": { "$ref": "#/definitions/SessionId" },
        "preMeditationMood": { "$ref": "#/definitions/MoodLevel" },
        "postMeditationMood": { "$ref": "#/definitions/MoodLevel" },
        "energyLevel": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "timestamp": { 
          "type": "string", 
          "format": "date-time" 
        },
        "notes": {
          "type": "string",
          "maxLength": 300
        }
      }
    },
    "SecurityEvent": {
      "type": "object",
      "required": ["eventType", "timestamp", "severity"],
      "properties": {
        "eventType": {
          "type": "string",
          "enum": [
            "connection_attempt",
            "failed_authentication",
            "unauthorized_access",
            "data_breach_attempt",
            "session_timeout",
            "encryption_failure"
          ]
        },
        "timestamp": { 
          "type": "string", 
          "format": "date-time" 
        },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "userId": { "$ref": "#/definitions/UserId" },
        "sessionId": { "$ref": "#/definitions/SessionId" },
        "details": {
          "type": "object",
          "description": "Additional event-specific data"
        },
        "ipAddress": {
          "type": "string",
          "format": "ipv4"
        },
        "userAgent": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "ZenMoonAvatarState": {
      "type": "object",
      "required": ["expression", "position"],
      "properties": {
        "expression": { "$ref": "#/definitions/ExpressionName" },
        "position": {
          "type": "object",
          "required": ["x", "y"],
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" }
          }
        },
        "pulseSize": {
          "type": "string",
          "enum": ["small", "medium", "large"]
        },
        "pulseColor": {
          "type": "string",
          "enum": ["blue", "purple", "pink", "gold", "green"]
        },
        "isFloating": { "type": "boolean" },
        "breathingRate": {
          "type": "number",
          "minimum": 1,
          "maximum": 30,
          "description": "Breaths per minute"
        },
        "energy": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    }
  }
}
